"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  main.py  â€”  Pipeline Orchestrator                          â•‘
â•‘                                                              â•‘
â•‘  This file wires the three agents together into a graph     â•‘
â•‘  and runs the full pipeline.                                 â•‘
â•‘                                                              â•‘
â•‘  âš ï¸  DO NOT EDIT THIS FILE.                                  â•‘
â•‘  Your group's bug is in agents/ â€” fix it there.             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

HOW TO RUN:
  python main.py
"""

from langgraph.graph import StateGraph, END
from config.settings import DigestState
from agents.fetcher import fetcher_node
from agents.tagger import tagger_node
from agents.editor import editor_node

# â”€â”€â”€ BUILD THE GRAPH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
workflow = StateGraph(DigestState)

workflow.add_node("fetcher", fetcher_node)
workflow.add_node("tagger",  tagger_node)
workflow.add_node("editor",  editor_node)

workflow.set_entry_point("fetcher")
workflow.add_edge("fetcher", "tagger")
workflow.add_edge("tagger",  "editor")
workflow.add_edge("editor",  END)

app = workflow.compile()

# â”€â”€â”€ RUN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if __name__ == "__main__":
    inputs = {
        "topic":    "Scientists discover a new deep-sea creature near volcanic vents",
        "summary":  "",
        "tags":     "",
        "headline": ""
    }

    print("ğŸš€ Starting News Digest Pipeline...\n")

    accumulated = {**inputs}
    for step in app.stream(inputs):
        for node_output in step.values():
            accumulated.update(node_output)

    print("\n" + "â•" * 55)
    print("ğŸ“°  FINAL DIGEST")
    print("â•" * 55)
    print(f"ğŸ“‹  Summary  : {accumulated.get('summary',  '[missing]')}")
    print(f"ğŸ·ï¸   Tags     : {accumulated.get('tags',     '[missing]')}")
    print(f"ğŸ“°  Headline : {accumulated.get('headline', '[missing]')}")
    print("â•" * 55)
